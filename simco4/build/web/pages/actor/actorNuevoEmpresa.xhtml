<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns:jsf="http://xmlns.jcp.org/jsf" 
      xmlns:gc="http://xmlns.jcp.org/jsf/composite/gc">
    <ui:composition template="../template/template.xhtml">
        <ui:define name="content">
            <h:form class="form-horizontal" id="idFormActorNuevo">
                <gc:confirmSubmit classGC="confirmacion2" bean="#{actorController.registrarActorEmpresa()}"/>
                <script>
                    sessionStorage.setItem('menuHijoSession', 'Nuevo');
                </script>
                <div>
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation">
                            <a jsf:action="#{actorController.cargarPagina()}" aria-controls="home" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-user" style="font-size:medium"/>
                                <span class="text-resalt-comun"/>Población
                            </a>
                        </li>
                        <li role="presentation" class="active">
                            <a  jsf:action="#{actorController.cargarPaginaEmpresa()}" aria-controls="profile" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-user" style="font-size:medium"/>
                                <span class="text-resalt-comun"/>Organización / empresa
                            </a>
                        </li>
                        <li role="presentation">
                            <a jsf:action="#{actorController.cargarPaginaEntidad()}" aria-controls="messages" role="tab" data-toggle="tab">
                                <span class="glyphicon glyphicon-user" style="font-size:medium"/>
                                <span class="text-resalt-comun"/>Entidad estatal
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <div role="tabpanel" id="home">
                            
                        </div>
                        <div role="tabpanel" class="tab-pane active" id="profile">
                            <script>
                                function validaLengDNI() {
                                    if ($("#idDniActor").val().length !== 8) {
                                        $('#idDniActor').addClass('error');
                                        alertar("Debe de tener 8 digitos el DNI");
                                        return false;
                                    } else {
                                        $('#idDniActor').removeClass('error');
                                        loadingModal();
                                        return true;
                                    }
                                }

                                $(document).ready(function () {
                                    $('#idBotonGuardar2').on('click', function () {
                                        if ($("input:checked").val() === "0") {
                                            $('.idClasificacion').addClass('df_input_error');
                                            $('.idClasificacion').focus();
                                            alertar("Debe de ingresar la clasificación");
                                            return false;
                                        }
                                        else {
                                            $('.idClasificacion').removeClass('df_input_error');
                                        }
                                        if ($('#idNombreEmpresa').val() === "") {
                                            $('#idNombreEmpresa').addClass('df_input_error');
                                            $('#idNombreEmpresa').focus();
                                            alertar("Debe de ingresar el nombre de la empresa u organización");
                                            return false;
                                        }
                                        else {
                                            $('#idNombreEmpresa').removeClass('df_input_error');
                                        }
                                        if ($('#rucEmpresa').val() !== "") {
                                            if ($('#rucEmpresa').val().length !== 11) {
                                                $('#rucEmpresa').addClass('df_input_error');
                                                $('#rucEmpresa').focus();
                                                alertar("El número de RUC debe contar con 11 digitos");
                                                return false;
                                            }
                                        } else {
                                            $('#rucEmpresa').removeClass('df_input_error');
                                        }
                                        confirmar2();
                                        return false;
                                    });
                                });
                                function confirmar2() {
                                    $(".confirmacion2").modal('show');
                                }
                            </script>
                            <div class="panel panel-default" style="width:100%">
                                <div class="panel-heading">
                                    <table style="width:100%">
                                        <tr>
                                            <td style="text-align:right">
                                                <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_002')}">
                                                <a class="btn btn-primary" id="idBotonGuardar2">
                                                    <span class="glyphicon glyphicon-floppy-disk"/>Guardar
                                                </a>
                                                    </h:panelGroup>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div id="idPanelBodyActuacion2" class="panel-body">
                                    <table style="width:100%">
                                        <tr style="width:80%">
                                            <td>
                                                <h:panelGroup id="addAcciones2">
                                                    <div class="form-group">
                                                        <table style="width:100%">
                                                            <tr>
                                                                <td style="width:50%;padding-right:5px">
                                                                    <div class="panel panel-featured-top-primary" style="height:500px">
                                                                        <div class="panel-body">
                                                                            <span class="text-resalt-primary">Datos generales</span>
                                                                            <br/><br/>
                                                                            <h:panelGroup id="idPanelOrganizacionM">
                                                                                <h:selectOneRadio class="idClasificacion" onclick="loadingModal()" value="#{actorController.empresa.clasificacion}">
                                                                                    <f:selectItem  itemLabel="Organización&#160;&#160;&#160;&#160;&#160;" itemValue="OR" />
                                                                                    <f:selectItem  itemLabel="Empresa " itemValue="EM" />
                                                                                    <f:ajax render="idPanelOrganizacionM" onevent="closeModal"/>
                                                                                </h:selectOneRadio>
                                                                                <br/>
                                                                                <h:panelGroup id="idPanelOrganizacion" rendered="#{actorController.empresa.clasificacion == 'OR'}">
                                                                                    <table style="width: 100%">
                                                                                        <tr>
                                                                                            <td style="width: 34%">
                                                                                                <label>Tipo:</label>
                                                                                                <h:selectOneMenu class="form-control" value="#{actorController.empresa.tipoOrganizacion}" onchange="loadingModal()">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaTipoOrganizacion}" />
                                                                                                    <f:ajax listener="#{actorController.cargarAjaxListaSubTipo1Organizacion()}" render="idPanelOrganizacion" onevent="closeModal"/>
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                            <td style="width: 34%">
                                                                                                <label>Sub-tipo1:</label>
                                                                                                <h:selectOneMenu value="#{actorController.empresa.subTipo1Organizacion}" onchange="loadingModal()">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaSubTipo1Organizacion}" />
                                                                                                    <f:ajax listener="#{actorController.cargarAjaxListaSubTipo2Organizacion()}" render="idPanelOrganizacion" onevent="closeModal"/>
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                            <td>
                                                                                                <label>Sub-tipo2:</label>
                                                                                                <h:selectOneMenu value="#{actorController.empresa.subTipo2Organizacion}">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaSubTipo2Organizacion}" />
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </h:panelGroup>
                                                                                <h:panelGroup id="idPanelEmpresa" rendered="#{actorController.empresa.clasificacion == 'EM'}">
                                                                                    <table style="width: 100%">
                                                                                        <tr>
                                                                                            <td style="width: 25%">
                                                                                                <label>Tipo:</label>
                                                                                                <h:selectOneMenu value="#{actorController.empresa.tipoEmpresa}">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaTipoEmpresa}" />
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                            <td style="width: 25%">
                                                                                                <label>Sub-tipo1:</label>
                                                                                                <h:selectOneMenu value="#{actorController.empresa.subTipo1Empresa}">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaSubTipo1Empresa}" />
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                            <td style="width: 25%">
                                                                                                <label>Sub-tipo2:</label>
                                                                                                <h:selectOneMenu value="#{actorController.empresa.subTipo2Empresa}" onchange="loadingModal()">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaSubTipo2Empresa}" />
                                                                                                    <f:ajax listener="#{actorController.cargarAjaxListaSubTipo3Empresa()}" render="idSubTipo3Orga" onevent="closeModal"/>
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                            <td style="width: 25%">
                                                                                                <label>Sub-tipo3:</label>
                                                                                                <h:selectOneMenu id="idSubTipo3Orga" value="#{actorController.empresa.subTipo3Empresa}">
                                                                                                    <f:selectItem itemValue="0" itemLabel="Seleccione" />
                                                                                                    <f:selectItems value="#{actorController.listaSubTipo3Empresa}" />
                                                                                                </h:selectOneMenu>
                                                                                            </td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </h:panelGroup>
                                                                            </h:panelGroup>
                                                                            <br/>
                                                                            <table style="width:100%">
                                                                                <tr>
                                                                                    <td style="padding-bottom: 5px"><b>Nombre:</b></td>
                                                                                    <td style="padding-bottom: 5px">
                                                                                        <input type="text" jsf:value="#{actorController.empresa.nombre}" id="idNombreEmpresa" placeholder="Nombre" maxlength="250"/>
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td style="padding-bottom: 5px"><b>RUC:</b></td>
                                                                                    <td style="padding-bottom: 5px">
                                                                                        <input type="text" jsf:value="#{actorController.empresa.ruc}" id="rucEmpresa" placeholder="RUC" style="width:50%" onkeypress="return soloNumbero(event)" maxlength="11"/>
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td style="padding-bottom: 5px"><b>Ámbito:</b></td>
                                                                                    <td style="padding-bottom: 5px">
                                                                                        <h:selectOneMenu id="cmbAmbito" value="#{actorController.empresa.empresaAmbito}">
                                                                                            <f:selectItem itemLabel="Seleccione" itemValue="0"/>
                                                                                            <f:selectItems value="#{listasComunesController.buscarAmbito(false, false, false)}" var="y" itemLabel="#{y.nombreParametro}" itemValue="#{y.valorParametro}" />
                                                                                        </h:selectOneMenu>
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td><b>Observaciones:</b></td>
                                                                                    <td>
                                                                                        <textarea jsf:value="#{actorController.empresa.observaciones}" rows="3" style="width:100%;height:170px" placeholder="Observaciones" maxlength="800"/>
                                                                                    </td>
                                                                                </tr>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td style="vertical-align:top;padding-left:5px">
                                                                    <div class="panel panel-featured-top-primary" style="height:500px">
                                                                        <div class="panel-body">
                                                                            <span class="text-resalt-primary">Datos de ubicación</span>
                                                                            <br/><br/><br/>
                                                                            <h:panelGroup id="idPanelUbigeoEmpresa">
                                                                                <table style="width: 100%">
                                                                                    <tr>
                                                                                        <td style="width: 34%">
                                                                                            <label><b>Departamento:</b></label><br/>
                                                                                            <h:selectOneMenu value="#{actorController.empresa.idDepartamento}" onchange="loadingModal()">
                                                                                                <f:selectItem itemLabel="Departamento" itemValue="0"/>
                                                                                                <f:selectItems value="#{actorController.listaDepartamento}" var="y" itemLabel="#{y.value}" itemValue="#{y.label}" />
                                                                                                <f:ajax listener="#{actorController.comboProvinciaEmpresa()}" render="idPanelUbigeoEmpresa" onevent="closeModal"/>
                                                                                            </h:selectOneMenu>
                                                                                        </td>
                                                                                        <td style="width: 34%">
                                                                                            <label><b>Provincia:</b></label><br/>
                                                                                            <h:selectOneMenu value="#{actorController.empresa.idProvincia}" onchange="loadingModal()">
                                                                                                <f:selectItem itemLabel="Provincia" itemValue="0"/>
                                                                                                <f:selectItems value="#{actorController.listaProvincia}" var="y" itemLabel="#{y.value} #{y.label}" itemValue="#{y.id}" />
                                                                                                <f:ajax listener="#{actorController.comboDistritoEmpresa()}" render="idPanelUbigeoEmpresa" onevent="closeModal"/>
                                                                                            </h:selectOneMenu>
                                                                                        </td>
                                                                                        <td>
                                                                                            <label><b>Distrito:</b></label><br/>
                                                                                            <h:selectOneMenu value="#{actorController.empresa.idDistrito}">
                                                                                                <f:selectItem itemLabel="Distrito" itemValue="0"/>
                                                                                                <f:selectItems value="#{actorController.listaDistrito}" var="y" itemLabel="#{y.value} #{y.label}" itemValue="#{y.id}" />
                                                                                            </h:selectOneMenu>
                                                                                        </td>
                                                                                    </tr>
                                                                                </table>
                                                                            </h:panelGroup>
                                                                            <br/>
                                                                            <label><b>Dirección:</b></label>
                                                                            <textarea rows="3" jsf:value="#{actorController.empresa.direccion}" style="width:100%;height:170px" placeholder="Dirección" maxlength="400"/>
                                                                            <br/>
                                                                            <table>
                                                                                <tr>
                                                                                    <td style="padding-bottom: 5px">
                                                                                        <b>Teléfono: </b>
                                                                                    </td>
                                                                                    <td style="padding-bottom: 5px">
                                                                                        <input type="text" jsf:value="#{actorController.empresa.telefono}" placeholder="Numero" style="width:100%" maxlength="20"/>
                                                                                    </td>
                                                                                    <td style="padding-bottom: 5px">
                                                                                       <input type="text" jsf:value="#{actorController.empresa.anexo}" placeholder="Anexo" style="width:100%" maxlength="20"/>
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td><b>Correo eléctronico: </b></td>
                                                                                    <td colspan="2">
                                                                                        <input type="text" jsf:value="#{actorController.empresa.email}" placeholder="Correo eléctronico" style="width:100%" maxlength="180"/>
                                                                                    </td>
                                                                                </tr>
                                                                            </table>
                                                                            <br/><br/><br/><br/><br/><br/>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td colspan="2">
                                                                    <h:panelGroup rendered="#{actorController.empresa.id != null}">
                                                                        <script>
                                                                            /*<![CDATA[*/$(function () {
                                                                            #{actorController.cadenaAutocomplete}
                                                                                $("#actor").autocomplete({minLength: 3, source: projects, focus: function (event, ui) {
                                                                                        $("#actor").val(ui.item.label);
                                                                                        return false;
                                                                                    }, select: function (event, ui) {
                                                                                        $("#actor").val(ui.item.label);
                                                                                        $("#actor-id").val(ui.item.value);
                                                                                        return false;
                                                                                    }}).data("ui-autocomplete")._renderItem = function (ul, item) {
                                                                                    return $("<li/>").append("<a>" + item.label + "<br/>" + item.desc + "</a>").appendTo(ul);
                                                                                };
                                                                            });
                                                                            /*]]>*/
                                                                        </script>
                                                                        <table style="width:100%">
                                                                            <tr>
                                                                                <td style="width:50%;padding-right:5px;vertical-align:top">
                                                                                    <div class="panel panel-featured-top-primary">
                                                                                        <div class="panel-body">
                                                                                            <span class="text-resalt-primary">Búsqueda de miembros</span>
                                                                                            <br/>
                                                                                            <script>
                                                                                                function limpiarCampoActor(data) {
                                                                                                    if (data.status === 'success') {
                                                                                                        $('#actor').val("");
                                                                                                        $('#actor-id').val("");
                                                                                                        $("#loadModal").modal('hide');
                                                                                                        $('body').removeClass('modal-open');
                                                                                                        $(".modal-backdrop").removeClass("modal-backdrop");
                                                                                                    }
                                                                                                }
                                                                                            </script>
                                                                                            <div id="idDivActorMiembro" class="form-group has-feedback" style="width:50%;text-align:left">
                                                                                                <input type="text" id="actor" jsf:value="#{actorController.actorMiembro.nombre}" />
                                                                                                <input type="hidden" jsf:value="#{actorController.actorMiembro.idMiembro}" id="actor-id" />
                                                                                                <a style="font-size:large;margin:auto" jsf:action="#{actorController.addMiembro()}" jsf:onclick="loadingModal()">
                                                                                                    <span class="glyphicon glyphicon-plus form-control-feedback"/>
                                                                                                    <f:ajax render="@form" execute="@form" onevent="limpiarCampoActor"/>
                                                                                                </a>
                                                                                            </div>
                                                                                            <br/><br/>
                                                                                            <h:dataTable value="#{actorController.listaMiembros}" var="mienbro" id="idDatatableMiembros" class="table table-striped" style="width:100%" binding="#{row}" rendered="#{actorController.listaMiembros.size() > 0}">
                                                                                                <h:column>
                                                                                                    <f:facet name="header">N.°</f:facet>
                                                                                                    <h:outputText value="#{row.rowIndex+1}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <f:facet name="header">Nombre</f:facet>
                                                                                                    <h:outputText value="#{mienbro.nombre}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <f:facet name="header">Cargo</f:facet>
                                                                                                    <h:inputText value="#{mienbro.cargo}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <a jsf:action="#{actorController.addMiembroGuardar(mienbro)}" jsf:onclick="loadingModal()">
                                                                                                        <span style="font-size:large" class="glyphicon glyphicon-floppy-disk"></span>
                                                                                                    </a>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <a jsf:action="#{actorController.removeTempMiembro(mienbro)}" jsf:onclick="loadingModal()">
                                                                                                        <span style="color:red;font-size:large" class="glyphicon glyphicon-remove"></span>
                                                                                                    </a>
                                                                                                </h:column>
                                                                                            </h:dataTable>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>
                                                                                <td style="padding-left:5px;vertical-align:top">
                                                                                    <div class="panel panel-featured-top-primary">
                                                                                        <div class="panel-body">
                                                                                            <span class="text-resalt-primary">Miembros añadidos en la empresa</span>
                                                                                            <br/>
                                                                                            <h:dataTable value="#{actorController.listaMiembrosRegistrados}" var="mienbros" id="idDatatableMiembrosRegistrados" class="table table-striped" style="width:100%" binding="#{row2}" rendered="#{actorController.listaMiembrosRegistrados.size() > 0}">
                                                                                                <h:column>
                                                                                                    <f:facet name="header">N.°</f:facet>
                                                                                                    <h:outputText value="#{row2.rowIndex+1}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <f:facet name="header">Nombre</f:facet>
                                                                                                    <h:outputText value="#{mienbros.nombre}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <f:facet name="header">Cargo</f:facet>
                                                                                                    <h:outputText value="#{mienbros.cargo}"/>
                                                                                                </h:column>
                                                                                                <h:column>
                                                                                                    <a jsf:action="#{actorController.removeMiembroRegistrado(mienbros)}" jsf:onclick="loadingModal()">
                                                                                                        <span style="color:red;font-size:large" class="glyphicon glyphicon-remove"/>
                                                                                                    </a>
                                                                                                </h:column>
                                                                                            </h:dataTable>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </h:panelGroup>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </h:panelGroup>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>            
                        </div>
                        <div role="tabpanel" class="tab-pane" id="messages">
                            
                        </div>
                    </div>
                </div>
                <script>
                    function openRegistroPersona(data) {
                        if (data.status === 'success') {
                            $("#loadModal").modal('hide');
                            $('body').removeClass('modal-open');
                            $(".modal-backdrop").removeClass("modal-backdrop");
                        }
                    }
                </script>
            </h:form>
        </ui:define>
    </ui:composition>
</html>